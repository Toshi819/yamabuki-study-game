console.log("script loaded");
const app = document.getElementById("app");
// ===== 教科データ =====
const subjects = ["国語", "数学", "言語文化","情報産業と社会"];
// ===== 回データ =====
const rounds = ["第1回", "第2回", "第3回"];
// ===== 問題データ =====
const quizData = {
  "数学": {
    "第1回": [
      {"q":"5×6は？","c":["11","30","56","60"],"a":1,"e":"5を6回足すと30"},
      {"q":"12÷3は？","c":["2","3","4","6"],"a":2,"e":"12を3で割ると4"},
      {"q":"7+8は？","c":["14","15","16","17"],"a":1,"e":"7と8を足すと15"}
    ],
    "第2回": [
      {"q":"9×3は？","c":["18","21","27","30"],"a":2,"e":"9を3回足すと27"},
      {"q":"15÷5は？","c":["2","3","4","5"],"a":1,"e":"15を5で割ると3"},
      {"q":"20-8は？","c":["10","11","12","13"],"a":2,"e":"20から8を引くと12"}
    ]
  },

  "国語": {
    "第1回": [
      {"q":"『美しい』の反対語は？","c":["きれい","みにくい","あかるい","たかい"],"a":1,"e":"美しいの反対はみにくい"}
    ]
  },

  "言語文化": {
        "第1回": [
            {"q":"三大歌集でないものは？","c":["万葉集","奥の細道","古今和歌集","新古今和歌集"],"a":1,"e":"奥の細道は松尾芭蕉によって書かれた俳句集だよ"},
            {"q":"万葉集の歌体でないものは？","c":["俳句","短歌","長歌","仏足石歌"],"a":0,"e":"俳句は江戸時代に出来たものだよ。ちなみに万葉集は短歌、長歌、旋頭歌、仏足石歌から構成されている"},
            {"q":"「万葉集」の成立した時代はいつですか？","c":["飛鳥時代","奈良時代","鎌倉時代","平安時代"],"a":1,"e":"万葉集は奈良時代に成立したとされています。"},
            {"q":"「万葉集」の編纂に関わったとされている、代表的な撰者は誰ですか？","c":["柿本人麻呂","大伴家持","紀貫之","額田王"],"a":1,"e":"大伴家持が「万葉集」の最終的な撰者と考えるられています。"},
            {"q":"「万葉集」の歌風を、男性的で力強くおおらかなさまから何と呼びますか？","c":["幽玄","たをやめぶり","わび・さび","ますらをぶり"],"a":3,"e":"「幽玄」は中世以降の美意識。「たをやめぶり」は、和歌のスタイルを表す言葉で、特に女性的で優雅な表現を指します。「わび・さび」は、室町時代。「ますらを（益荒男）は勇ましい男を表すから、ますらをぶりが正解"},
            {"q":"和歌の修辞のうち、特定の語句を導き出すために置かれる五音の言葉を何といいますか？","c":["序詞","枕詞","掛詞","縁語"],"a":1,"e":"枕詞は「あかねさす（→紫）」「たらちねの（→母）」のように、特定の語を導く「5音」の決まり文句です。"},
            {"q":"額田王の歌「あかねさす紫野行き…」において、「あかねさす」は次のどの語を導くか？","c":["紫","野守","標野","君"],"a":0,"e":"「あかねさす」は朝日が照り映える様子から、「紫」「日」「昼」などを導きます。この歌では「紫野」にかかっています。"},
            {"q":"大海人皇子の歌「紫のにほへる妹を…」の「にほへる」の本来の意味はどれか？","c":["良い香りがする","美しく照り映えている","泣いている","怒っている"],"a":1,"e":"古語の「にほふ」は視覚的な美しさを指し、「（色が）鮮やかに美しく映える」という意味が重要です。現代の「匂い」とは異なります。"},
            {"q":"同じく大海人皇子の歌「人妻ゆゑにわれ恋ひめやも」の「めやも」が表す表現技法はどれか？","c":["詠嘆","疑問","反語","命令"],"a":2,"e":"「～めやも」は反語の決まり文句。「～だろうか、いや、決して～ない」と訳し、強い否定の意志を込めます。"},
            {"q":"『万葉集』で「歌聖」と称される、長歌の完成者は誰か？","c":["山上憶良","大伴旅人","柿本人麻呂","阿倍仲麻呂"],"a":2,"e":"柿本人麻呂（かきのもとのひとまろ）は、宮廷歌人として長歌の形式を完成させ、後に「歌聖」として崇められました。"},
            {"q":"長歌の後に添えられ、内容を要約したり補足したりする短歌を何というか？","c":["本歌","反歌","贈答歌","挽歌"],"a":1,"e":"長歌（五七五七…と長い歌）の最後に、その内容を補足するために添えられる短歌を「反歌（かえしうた）」と言います。"},
            {"q":"東国（現在の関東地方）の民謡的な和歌を何というか？","c":["雅歌","防人歌","東歌","鄙歌"],"a":2,"e":"「東歌（あずまうた）」は、万葉集の巻十四に収められている東国地方（今の関東など）の民謡です。"},
            {"q":"東歌「多摩川にさらす手作り…」において、「さらさらに」という言葉を導き出している七音以上の修辞を何というか?","c":["枕詞","序詞","本歌取り","縁語"],"a":1,"e":"序詞は、枕詞と違って「7音以上」の自由な表現で、比喩や音の連想から後の言葉を導きます。「さらす」から「さらさらに」を導いています。"},
            {"q":"同じく「さらさらに何そこの児のここだかなしき」の「かなし」の意味はどれか?","c":["悲しい","貧しい","愛おしい（かわいい）","恐ろしい"],"a":2,"e":"古文の「かなし」は、「愛（かな）し」と書き、「切ないほど愛おしい、かわいい」という意味でよく使われます。"},
            {"q":"九州の沿岸警備のために東国から派遣された人々が詠んだ歌を何というか?","c":["遣唐使歌","防人歌","征夷歌","辺境歌"],"a":1,"e":"防人（さきもり）は、唐や新羅の侵攻に備えて九州を守らされた兵士たちです。主に東国の人々が徴用されました。"},
            {"q":"「父母が頭かき撫で幸くあれて言ひし言葉ぜ忘れかねつる」の作者は誰か?","c":["丈部稲麻呂","安倍仲麻呂","大伴家持","山部赤人"],"a":0,"e":"資料に記載されている「丈部稲麻呂（はせつかべのいなまろ）」による歌です。家族との別れを詠んだ有名な防人歌です。"},
            {"q":"前問の歌に含まれる「言葉ぜ」の「ぜ」は、本来のどの助詞が方言化したものか?","c":["は","も","ぞ","よ"],"a":2,"e":"東国方言の特徴です。強調の係助詞「ぞ」が「ぜ」と発音されています。"},
            {"q":"助動詞「き」の意味と、接続する活用形はどれか?","c":["推量・未然形","過去・連用形","完了・終止形","打消・未然形"],"a":1,"e":"助動詞「き」は「過去（～た）」を意味し、動詞の「連用形」にくっつきます。活用は「せ・○・き・し・しか・○」です。"},
            {"q":"助動詞「つ」の活用形のうち、「つ・つ・つ・つる・つれ・てよ」の連体形はどれか?","c":["つ","つる","つれ","てよ"],"a":1,"e":"助動詞「つ」は完了・強意を表します。連体形は「つる」です。「忘れかねつる」の形は、係助詞「ぜ（ぞ）」による係り結びで連体形になっています。"},
            {"q":"万葉集の部立て（分類）のうち、男女の恋愛に関する歌を何というか?","c":["雑歌","挽歌","相聞","恋歌"],"a":2,"e":"万葉集の三大部立ては、①雑歌（公的な歌）、②相聞（恋の歌）、③挽歌（死を悼む歌）です。"}            
        ],
        "第2回": [
            {"q":"『古今和歌集』が成立した時代として正しいものはどれか？","c":["奈良時代","平安時代","鎌倉時代","室町時代"],"a":1,"e":"『古今和歌集』は905年（延喜5年）、平安時代に成立しました。ちなみにAは『万葉集』、Cは『新古今和歌集』の成立時代です。"},
            {"q":"天皇の命によって編纂された歌集を何と呼ぶか？","c":["私撰和歌集","家集","勅撰和歌集","万葉集"],"a":2,"e":"天皇や上皇の命令（勅命）によって編集されたものを「勅撰和歌集（ちょくせんわかしゅう）」と呼びます。『古今和歌集』は日本で最初の勅撰和歌集です。"},
            {"q":"『古今和歌集』の編纂を命じた天皇は誰か？","c":["桓武天皇","醍醐天皇","後鳥羽上皇","聖武天皇"],"a":1,"e":"醍醐（だいご）天皇の命により編纂が始まりました。桓武天皇は蝦夷討伐や平安京の人。後鳥羽上皇は百人一首のひと（確か記憶によると）。聖武天皇は東大寺の人"},
            {"q":"『古今和歌集』の四撰者の一人であり、実質的な責任者とされる人物は誰か？","c":["紀貫之","在原業平","小野小町","柿本人麻呂"],"a":0,"e":"紀貫之（きのつらゆき）、紀友則、凡河内躬恒、壬生忠岑の4人が撰者です。中でも貫之は中心的な役割を果たしました。"},
            {"q":"『古今和歌集』の歌風を表現する言葉として適切なものはどれか？","c":["ますらをぶり","幽玄","たをやめぶり","わび・さび"],"a":2,"e":"万葉集の力強い「ますらをぶり」に対し、古今集は繊細で優美な「たをやめぶり」と呼ばれます。"},
            {"q":"『古今和歌集』の表記の大きな特徴は何か？","c":["全て漢字","漢文","仮名（ひらがな）が中心","ローマ字"],"a":2,"e":"仮名が中心となったことで、女性歌人も多く活躍するようになり、繊細な心情表現が可能になりました。"},
            {"q":"紀貫之が執筆した、日本最初の本格的な文学論とされる序文の名前は何か？","c":["真名序","仮名序","土佐日記","和歌の心"],"a":1,"e":"仮名（ひらがな）で書かれた序文なので「仮名序（かなじょ）」といいます。"},
            {"q":"仮名序の冒頭「やまとうたは、人の心を種として、よろづの（　）となれりける」の空欄に入る言葉は何か？","c":["花","言の葉","実","根"],"a":1,"e":"「言葉」を樹木の「葉」に例えた表現です。心という種から、たくさんの言葉の葉が生い茂るという和歌の本質を説いています。"},
            {"q":"仮名序で貫之が批評した、6人の代表的な歌人を総称して何と呼ぶか？","c":["三十六歌仙","竹林の七賢","六歌仙","古今四天王"],"a":1,"e":"在原業平、小野小町など、平安初期を代表する6人の歌人を指します。"},
            {"q":"紀貫之は在原業平の歌をどのように評したか？","c":["言葉は立派だが中身がない","心あまりて言葉たらず","田舎くさくて洗練されていない","非常に弱々しい"],"a":1,"e":"「想い（心）が強すぎて、それを表現する言葉が追いついていない」という、業平の情熱的なスタイルを評した言葉です。"},
            {"q":"「松」と「待つ」のように、一つの言葉に二つの意味を持たせる技法は何か？","c":["枕詞","縁語","掛詞","序詞"],"a":2,"e":"同音異義語を利用して、一石二鳥の意味を持たせるレトリックです。"},
            {"q":"一首の中に、ある言葉と関連の深い語を散りばめる技法は何か（例：弓に対して「張る」「引く」）。？","c":["縁語","本歌取り","体言止め","句切れ"],"a":0,"e":"言葉の「縁（ゆかり）」をたどる技法です。知的な遊び心が感じられるのが古今集の特徴です。"},
            {"q":"仮名序で貫之が批評した、6人の代表的な歌人を総称して何と呼ぶか？","c":["過去","完了","反実仮想","当然"],"a":2,"e":"「もし～なら･･･だろうに（実際はそうではない）」と、現実と反対のことを仮定する意味です。"},
            {"q":"「世の中にたえて桜のなかりせば春の心はのどけからまし」の歌のテーマは何か？","c":["桜が全くないので悲しい","桜のせいで心が落ち着かないが、それほど桜が愛おしい","春はのんびり過ごすのが一番だ","桜が早く散ってほしい"],"a":1,"e":"「桜がなければ心穏やかだろうに」とあえて言うことで、桜に一喜一憂してしまう執着の深さを逆説的に表現しています。"},
            {"q":"和歌の中で「～たのだなあ」と、ある事実に気づいた驚きを表す「けり」の意味は何か？","c":["過去","伝聞","詠嘆","存続"],"a":2,"e":"目の前の情景に対して「はっ」と気づいた感動を表す「気づきの詠嘆」です。"},
            {"q":"「秋来ぬと目にはさやかに見えねども風の音にぞおどろかれぬる」における「おどろく」の意味は何か？","c":["びっくりして飛び起きる","怖くて震える","自然に気づく","怒る"],"a":2,"e":"古語の「おどろく」は「（はっと）気づく」「目が覚める」という意味です。"},
            {"q":"紀貫之の歌「水なき空に波ぞ立ちける」において、「波」は何に例えられているか？","c":["白い雲","散る桜の花びら","激しい風","泳ぐ魚"],"a":1,"e":"風で舞い散る桜を、空という海に立つ「波」に見立てています。"},
            {"q":"小野小町の歌「思ひつつ寝ればや人の見えつらむ」における「つらむ」の構成として正しいのはどれか。","c":["強意「つ」＋現在推量「らむ」","過去「けり」＋意志「む」","完了「ぬ」＋現在推量「らむ」","打消「ず」＋推量「む」"],"a":0,"e":"「（夢に）見えてしまったのだろうか」という、完了した事態への現在の推量です。"},
            {"q":"紀貫之が『仮名序』で、小野小町の歌を評した言葉として適切なものはどれか。","c":["想いが溢れすぎている","言葉は立派だが中身が薄い","哀れで、弱々しい","田舎の人が重い荷物を背負っているよう"],"a":2,"e":"「あはれなるやうにて、つよからず（身に沁みるようだが、力強さがない）」と評しました。"},
            {"q":"『古今和歌集』が、その後の日本文学に与えた影響として正しいものはどれか。","c":["和歌の伝統を否定した","日本独自の美意識の基準となった","漢字のみの表記を推奨した","武士の力強さを理想とした"],"a":1,"e":"古今集で確立された技巧や美意識は、その後の文学の「手本」となりました。"}
        ],
        "第3回":[
            {"q":"『新古今和歌集』が成立した時代はいつか。","c":["奈良時代","平安時代","鎌倉時代","江戸時代"],"a":2,"e":"1205年に成立した、鎌倉時代を代表する勅撰和歌集です。"},
            {"q":"『新古今和歌集』は、最初の勅撰和歌集である『古今和歌集』からちょうど何年後に成立したか。","c":["100年後","200年後","300年後","500年後"],"a":2,"e":"古今集（905年）のちょうど300年後にあたる1205年に成立しました。"},
            {"q":"『新古今和歌集』の編纂を命じたのは誰か。","c":["醍醐天皇","後醍醐天皇","後鳥羽院（上皇）","白河上皇"],"a":2,"e":"後鳥羽院（後鳥羽上皇）の命によって編纂されました。"},
            {"q":"『新古今和歌集』は、何番目の勅撰和歌集（八代集の最後）にあたるか。","c":["3番目","5番目","8番目","10番目"],"a":2,"e":"古今・後撰・拾遺・後拾遺・金葉・詞花・千載・新古今の順で、八番目の勅撰和歌集です。"},
            {"q":"『新古今和歌集』の代表的な撰者で、中世の歌壇に大きな影響を与えたのは誰か。","c":["紀貫之","藤原定家","藤原道長","在原業平"],"a":1,"e":"藤原定家（ふじわらのさだいえ／ていか）ら6人の撰者によって編纂されました。"},
            {"q":"『新古今和歌集』の歌風を表現する言葉として適切なものはどれか。","c":["ますらをぶり","たをめぶり","幽玄・有心（うしん）","素朴・率直"],"a":2,"e":"絵画的で象徴的、奥深い情趣を尊ぶ「幽玄（ゆうげん）」や「有心」が特徴です。"},
            {"q":"有名な古歌（本歌）の言葉や趣向を取り入れて、新しい歌を作る表現技法を何というか。","c":["掛詞","本歌取り","縁語","枕詞"],"a":1,"e":"「本歌取り（ほんかどり）」は、読者に本歌を連想させることで歌の世界観を深める高度な技法です。"},
            {"q":"歌の末尾を名詞（体言）で終わらせ、余韻を残す表現技法を何というか。","c":["体言止め","句切れ","見立て","反語"],"a":0,"e":"「体言止め」は新古今集で多用され、余情を強く残す効果があります。"},
            {"q":"藤原定家の歌「見渡せば花も紅葉もなかりけり･･･」の本歌となっているのはどの歌集の歌か。","c":["万葉集","古今和歌集","伊勢物語","拾遺和歌集"],"a":0,"e":"『万葉集』にある巻門（まきもん）の歌などを本歌としています。"},
            {"q":"藤原定家の歌「見渡せば花も紅葉もなかりけり」に続く、下句はどれか。","c":["秋の夕暮れの寂しさに","浦の苫屋の秋の夕暮れ","いづこも同じ秋の夕暮れ","波ぞ立ちける秋の夕暮れ"],"a":1,"e":"正解は「浦の苫屋（とまや）の秋の夕暮れ」です。"},
            {"q":"藤原定家の歌で、あえて「花も紅葉もなかりけり」と否定することで表現しようとした美意識は何か。","c":["冬の厳しさ","何もないからこその究極の静寂と美","春や秋への不満","貧しさの強調"],"a":1,"e":"華やかな美を否定することで、その先にある本質的な「無」の美、寂寥感を表現しています。"},
            {"q":"寂蓮法師の歌「寂しさはその色としもなかりけり」に続く、下句はどれか。","c":["山の下風秋の夕暮れ","浦の苫屋の秋の夕暮れ","真木立つ山の秋の夕暮れ","いづこも同じ秋の夕暮れ"],"a":2,"e":"正解は「真木（まき）立つ山の秋の夕暮れ」です。"},
            {"q":"「三夕（さんせき）の歌」とは、結びが全てどのような言葉で終わる三つの有名な歌のことか。","c":["なかりけり","秋の夕暮れ","有明の月","冬の夜かな"],"a":1,"e":"藤原定家、寂蓮、西行の歌で、いずれも「秋の夕暮れ」で結ばれます。"},
            {"q":"西行法師の歌「心なき身にもあはれは知られけり」において、「心なき身」とはどういう意味か。","c":["死んでいる体","出家して欲を捨てた身","情け知らずな性格","記憶喪失"],"a":1,"e":"出家して世俗の感情を捨てたはずの自分の身、という意味です。"},
            {"q":"助動詞「ぬ」が「～てしまう」という強い確信（強意）を表す場合、下に続く言葉の形はどうなることが多いか。","c":["推量（む・べしなど）","打消（ず）","完了（り）","断定（なり）"],"a":0,"e":"「ぬ」の下に推量の語（む、べし、らむ等）が来るとき、強意（きっと～する）の意味になります。"},
            {"q":"式子内親王の歌「玉の緒よ絶えなば絶えねながらへば」の「絶えね」の「ね」は何の助動詞の何形か。","c":["打消「ず」の已然形","完了・強意「ぬ」の命令形","完了「ぬ」の終止形","意志「む」のねじれ形"],"a":1,"e":"「絶えてしまえ」という、完了・強意の助動詞「ぬ」の命令形です。"},
            {"q":"式子内親王の歌で「玉の緒（命をつなぐ紐）」が象徴しているものは何か。","c":["自分の命","恋人との絆","真珠のネックレス","時の流れ"],"a":0,"e":"「玉の緒」は「命」を指す枕詞的な表現で、ここでは忍ぶ恋の苦しさを表現しています。"},
            {"q":"『新古今和歌集』の撰者の一人で、隠者（出家者）として有名な歌人は誰か。","c":["藤原定家","西行法師","藤原家隆","寂蓮法師"],"a":1,"e":"西行は漂泊の歌人として知られ、自然と孤独を詠んだ多くの名歌を残しました。"},
            {"q":"『新古今和歌集』の時代の美意識である「有心（うしん）」とは、どのような態度を指すか。","c":["適当に歌を作ること","深く心を込めて、美を追求すること","面白いことを詠むこと","事実のみを記録すること"],"a":1,"e":"言葉の技巧だけでなく、その奥にある深い精神性や美を重んじる態度です。"},
            {"q":"資料にある「和歌文化と現代日本とのつながり」について、どのような例が考えられるか。","c":["おみくじや百人一首","SNSの短文投稿","歌詞の言葉選び","これらすべて"],"a":3,"e":"限られた文字数で感情を伝える文化は、現代の様々な形に引き継がれています。"}
        ],
        "和歌まとめ":[
            {"q":"三大歌集を成立したのが古い順に並べたとき、正しいものはどれか。","c":["万葉集→新古今集→古今集","古今集→万葉集→新古今集","万葉集→古今集→新古今集","新古今集→古今集→万葉集"],"a":2,"e":"奈良（万葉）、平安（古今）、鎌倉（新古今）の順です。"},
            {"q":"『万葉集』の歌風を表現する言葉として正しいものはどれか。","c":["たをめぶり","ますらをぶり","幽玄・有心","もののあはれ"],"a":1,"e":"力強く素朴な「ますらを（勇ましい男）」のような歌風を指します。"},
            {"q":"『古今和歌集』の歌風を表現する言葉として正しいものはどれか。","c":["ますらをぶり","幽玄","たをめぶり","実事求是"],"a":2,"e":"しなやかで優美な「たをめ（手弱女）」のような歌風を指します。"},
            {"q":"『新古今和歌集』の歌風を表現する言葉として正しいものはどれか。","c":["ますらをぶり","たをめぶり","幽玄・有心","素朴・率直"],"a":2,"e":"絵画的で象徴的な深みを追求する美意識です。"},
            {"q":"日本で最初の勅撰和歌集（天皇の命令で編纂されたもの）はどれか。","c":["万葉集","古今和歌集","新古今和歌集","後撰和歌集"],"a":1,"e":"『万葉集』は私撰集的な性格が強く、最初の勅撰集は『古今集』です。"},
            {"q":"『万葉集』で使われた、漢字の音訓を用いて日本語を表記する方法を何というか。","c":["仮名序","万葉仮名","掛詞","本歌取り"],"a":1,"e":"まだ平仮名がない時代、漢字を文字としてではなく「音」として使いました。"},
            {"q":"紀貫之が『古今集』の序文で「心あまりて言葉たらず」と評したのは誰か。","c":["小野小町","在原業平","西行","藤原定家"],"a":1,"e":"想いが強すぎて言葉が追いつかない、業平の情熱を評しています。"},
            {"q":"『新古今集』で多用された、有名な古歌のフレーズを引用する技法は何か。","c":["縁語","枕詞","本歌取り","序詞"],"a":2,"e":"伝統を踏まえつつ新しい世界を作る、中世特有の高度な技法です。"},
            {"q":"『万葉集』の代表的歌人で「歌聖」と呼ばれるのは誰か。","c":["藤原定家","紀貫之","柿本人麻呂","西行"],"a":2,"e":"宮廷歌人として長歌を完成させた、万葉時代最高の歌人です。"},
            {"q":"『新古今集』の撰者の一人で、「見渡せば花も紅葉もなかりけり」を詠んだのは誰か。","c":["藤原定家","式子内親王","寂蓮","西行"],"a":0,"e":"中世歌壇のリーダーであり、新古今集の中心的撰者です。"},
            {"q":"「あかねさす」のように、特定の語を導き出す五音の定型句を何というか。","c":["序詞","縁語","枕詞","掛詞"],"a":2,"e":"万葉時代から続く、和歌の代表的な修辞法です。"},
            {"q":"「世の中にたえて桜のなかりせば」の「せば～まし」の構文が表す意味は何か。","c":["過去の回想","現在の進行","反実仮想","強い禁止"],"a":2,"e":"「もし～であったなら（実際は違うが）～だろうに」という意味です。"},
            {"q":"『万葉集』に収録されている、東国の民謡的な歌を何というか。","c":["防人歌","東歌","相聞歌","挽歌"],"a":1,"e":"当時の東日本（関東など）の庶民の生活や恋が詠まれています。"},
            {"q":"『古今集』の修辞「縁語」の説明として正しいものはどれか。","c":["五音で言葉を導く","同音異義語を掛ける","関連のある語を連想させる","名詞で文を終える"],"a":2,"e":"「糸」に対して「乱る」「縒る」のように関連語を並べる技法です。"},
            {"q":"『新古今集』に多く見られる「体言止め」の効果は何か。","c":["意味を限定する","余韻・余情を残す","リズムを速める","命令の意を表す"],"a":1,"e":"名詞で止めることで、読者の想像力をかき立てる効果があります。"},
            {"q":"「三夕の歌」の結びの句はすべて共通して何か。","c":["有明の月","秋の夕暮れ","冬の夜かな","春のあけぼの"],"a":1,"e":"定家・寂蓮・西行の三者が「秋の夕暮れ」の情景を競いました。"},
            {"q":"「父母が頭かき撫で～」の歌において、作者の生々しい感情を伝えている要素は何か。","c":["洗練された掛詞","本歌取りの技巧","方言の響き","漢文の知識"],"a":2,"e":"東国方言（ぜ、つる等）が、別れの悲しみをリアルに伝えています。"},
            {"q":"助動詞「けり」が和歌の中で「～たのだなあ（新発見）」を表すときの意味は何か。","c":["過去","存続","詠嘆","完了"],"a":2,"e":"和歌では「気づきの詠嘆」として使われるのが定番です。"},
            {"q":"式子内親王の歌「玉の緒よ絶えなば絶えね」の「絶えね」の「ね」の意味はどれか。","c":["打消","完了（強意）の命令","希望","禁止"],"a":1,"e":"「（命よ）絶えてしまえ」という強い決意を伴う命令です。"},
            {"q":"三大歌集を通じて、日本人が和歌に込めてきた最も根源的なものは何か。","c":["政治への不満","客観的なデータ","四季や恋に託した心の動き","外国への憧れ"],"a":2,"e":"「人の心を種として」という仮名序の通り、常に「心情」が中心でした。"}
        ]    
    },
    "情報産業と社会": {
        "第1回": [
            {"q":"コンピュータの基本的な動作の仕組みを正しく説明しているものはどれか。","c":["入力 → 処理 → 出力","出力 → 処理 → 入力","処理 → 入力 → 記憶","出力 → 入力 → 記憶"],"a":0,"e":"コンピュータは外部から情報を「入力」し、それを内部で「処理」し、結果を「出力」する機械です。"},
            {"q":"コンピュータの「5大装置」に含まれない装置はどれか。","c":["入力装置","出力装置","演算装置","通信装置"],"a":3,"e":"5大装置は「入力・出力・記憶・演算・制御」の5つです。通信装置は含まれません。"},
            {"q":"「演算装置」と「制御装置」を合わせた、コンピュータの心臓部にあたる部品を何というか。","c":["メモリ","CPU（中央処理装置）","SSD","マザーボード"],"a":1,"e":"CPUは、計算を行う演算装置と、各装置に命令を出す制御装置の役割を兼ねています。"},
            {"q":"CPUの役割を人間に例えたとき、最も適切なものはどれか。","c":["手足","目や耳","頭脳","胃袋"],"a":2,"e":"CPUはコンピュータ全体の制御と計算を司るため、人間の「頭脳」に例えられます。"},
            {"q":"「記憶装置」のうち、現在実行中のプログラムやデータを一時的に置いておく場所を何というか。","c":["補助記憶装置","主記憶装置","入力装置","出力装置"],"a":1,"e":"主記憶装置（メモリ）は、現在作業中のデータを一時的に置く場所です。"},
            {"q":"主記憶装置（メモリ）の役割を例えたとき、最も適切なものはどれか。","c":["本棚","作業中の机の上","倉庫","ゴミ箱"],"a":1,"e":"メモリは「作業中の机」に例えられます。机が広い（メモリが大きい）ほど、効率よく作業ができます。"},
            {"q":"「補助記憶装置」の説明として正しいものはどれか。","c":["計算を直接行う場所","データを長期間保存しておく場所","文字を入力する装置","画面に情報を出す装置"],"a":1,"e":"HDDやSSD、USBメモリなどが補助記憶装置で、電源を切ってもデータが消えない「本棚」のような役割です。"},
            {"q":"次のうち、「入力装置」に該当するものはどれか。","c":["プリンタ","ディスプレイ","キーボード","スピーカー"],"a":2,"e":"キーボードやマウスなど、人間がコンピュータに情報を入れるための装置が入力装置です。"},
            {"q":"次のうち、「出力装置」に該当するものはどれか。","c":["マイク","スキャナ","ディスプレイ","マウス"],"a":2,"e":"コンピュータ内の処理結果を人間に見える形などで出すのがディスプレイやプリンタなどの出力装置です。"},
            {"q":"CPUが命令を実行する一連の流れ（命令サイクル）の最初に来るステップはどれか。","c":["命令の解読","データの読み出し","命令の取り出し","命令の実行"],"a":2,"e":"命令サイクルは、①命令の取り出し→②命令の解読→③データの読み出し→④命令の実行 の順で行われます。"},
            {"q":"コンピュータが扱う情報の最小単位を何というか。","c":["バイト","ビット","キロバイト","メガバイト"],"a":1,"e":"「0」か「1」の2進数1桁分を表す最小単位が「ビット（bit）」です。"},
            {"q":"「1バイト（Byte）」は何ビットか。","c":["4ビット","8ビット","16ビット","32ビット"],"a":1,"e":"8個のビットをまとめた単位が「1バイト」です。"},
            {"q":"データの単位で、大きい順に並んでいるものはどれか。","c":["MB > GB > TB","TB > GB > MB","GB > TB > MB","MB > TB > GB"],"a":1,"e":"テラ(T) > ギガ(G) > メガ(M) > キロ(K) の順に1024倍（約1000倍）ずつ大きくなります。"},
            {"q":"周辺機器をコンピュータに接続するための、現在最も一般的な規格を何というか。","c":["CPU","SSD","USB","LAN"],"a":2,"e":"USB（Universal Serial Bus）は、マウス、キーボード、ドライブなど多様な機器を繋ぐ標準規格です。"},
            {"q":"「制御装置」の具体的な役割は何か。","c":["データを計算する","各装置に指示を出す","データを長期保存する","情報を画面に表示する"],"a":1,"e":"制御装置は、どの計算をするか、どのデータを使うかなどを決めて、各装置に命令を出します。"},
            {"q":"「演算装置」の具体的な役割は何か。","c":["命令を取り出す","情報を入力する","計算したり比べたりする","結果を印刷する"],"a":2,"e":"四則計算（足し算など）や、データの比較を行うのが演算装置です。"},
            {"q":"資料にある「マザーボード」の説明として適切なものはどれか。","c":["データを保存する円盤","CPUやメモリを載せる主要な基板","情報を入力するための板","演算のみを行うチップ"],"a":1,"e":"マザーボードはCPUやメモリ、各装置を接続するための土台となるメインの回路基板です。"},
            {"q":"情報の単位「1KB（キロバイト）」は、およそ何バイトか。","c":["10バイト","100バイト","1000バイト","1000000バイト"],"a":2,"e":"1KBは正確には1024バイトですが、一般的におよそ1000バイトと換算されます。"},
            {"q":"コンピュータがなければ起こり得ることとして、資料に記載されている例はどれか。","c":["YouTubeが見られない","交通機関がストップする","コンビニのレジが止まる","これらすべて"],"a":3,"e":"現代社会において、コンピュータは娯楽・交通・物流などあらゆるインフラを支えています。"},
            {"q":"「SSD」の役割として正しいものはどれか。","c":["命令を解読する","データを高速に読み書きする補助記憶装置","演算を専門に行う","文字を入力する"],"a":1,"e":"SSD（Solid State Drive）は、HDDに代わる高速な補助記憶装置として普及しています。"}
        ],
    "第2回":[
        {"q":"コンピュータが処理を進めるための一定のリズム（カチ、カチ…という信号）を何と呼ぶか。","c":["クロック信号","ビット信号","ヘルツ信号","パルス信号"],"a":0,"e":"コンピュータはこの「クロック」というリズムに合わせてすべての処理を行います。"},
        {"q":"1秒間に何回クロック（リズム）が鳴るかを表す値を何というか。","c":["処理速度","クロック周波数","リフレッシュレート","ビットレート"],"a":1,"e":"「周波数」とは1秒あたりの振動回数のことで、コンピュータではクロックの回数を指します。"},
        {"q":"周波数を表す単位「Hz」の読み方はどれか。","c":["ハーツ","ヘルツ","ハザード","ヘクト"],"a":1,"e":"Hz（ヘルツ）は、1秒間に1回の周期があることを表す単位です。"},
        {"q":"1GHz（ギガヘルツ）は、1秒間に何回のクロックがあることを意味するか。","c":["100万回","1000万回","1億回","10億回"],"a":3,"e":"G（ギガ）は10の9乗、つまり10億を表します。 "},
        {"q":"1MHz（メガヘルツ）は、1秒間に何回のクロックがあることを意味するか。","c":["100万回","1000万回","1億回","10億回"],"a":0,"e":"M（メガ）は10の6乗、つまり100万を表します。"},
        {"q":"2GHzのCPUがある。このCPUが1秒間に出すクロック回数はどれか。","c":["200万回","2000万回","2億回","20億回"],"a":3,"e":"2 × 10億 = 20億回となります。"},
        {"q":"500MHzを「Hz」に直したとき、正しいものはどれか。","c":["500,000Hz","5,000,000Hz","50,000,000Hz","500,000,000Hz"],"a":3,"e":"500 × 100万 = 5億Hzです。計算問題では必ずHzに直して考えます。"},
        {"q":"処理時間を求める公式として正しいものはどれか。","c":["処理回数 × クロック周波数","処理回数 ÷ 1秒あたりの回数（Hz）","1秒あたりの回数（Hz） ÷ 処理回数","クロック周波数 + 処理回数"],"a":1,"e":"時間 ＝ 処理したい回数 ÷ 1秒間にできる回数 で求められます。"},
        {"q":"2GHzのCPUで、10億回の処理を行う。処理時間は何秒か。","c":["0.2秒","0.5秒","2秒","5秒"],"a":1,"e":"式：10億 ÷ 20億 = 0.5秒 です。"},
        {"q":"1GHzのCPUで、30億回の処理を行う。処理時間は何秒か。","c":["0.3秒","1秒","3秒","30秒"],"a":2,"e":"式：30億 ÷ 10億 = 3秒 です。"},
        {"q":"2.5GHzのCPUで、50億回の処理を行う。処理時間は何秒か。","c":["0.5秒","2秒","2.5秒","5秒"],"a":1,"e":"式：50億 ÷ 25億 = 2秒 です。"},
        {"q":"500MHzのCPUで、5億回の処理を行う。処理時間は何秒か。","c":["0.1秒","1秒","5秒","10秒"],"a":1,"e":"式：5億 ÷ 5億 = 1秒 です。"},
        {"q":"3GHzのCPUで、4秒間に処理できる回数はどれか。","c":["7億回","12億回","70億回","120億回"],"a":3,"e":"式：30億 × 4秒 = 120億回 です。"},
        {"q":"1.2GHzのCPUで、5秒間に処理できる回数はどれか。","c":["6億回","12億回","60億回","120億回"],"a":2,"e":"式：12億 × 5秒 = 60億回 です。"},
        {"q":"0.8GHzを「Hz」に直すといくつになるか。","c":["800Hz","80,000Hz","8,000,000Hz","800,000,000Hz"],"a":3,"e":"0.8 × 10億 = 8億Hz です。"},
        {"q":"CPUの性能において、クロック周波数の数値が大きいほど、処理速度はどうなるか。","c":["遅くなる","変わらない","速くなる","不安定になる"],"a":2,"e":"1秒間に鳴るリズムが多いほど、それだけ多くの命令をこなせるため速くなります。"},
        {"q":"4GHzのCPUで、2秒間に処理できる回数はどれか。","c":["20億回","40億回","80億回","160億回"],"a":2,"e":"式：40億 × 2秒 = 80億回 です。"},
        {"q":"100MHzのCPUで、1秒間に処理できる回数はどれか。","c":["1,000回","100,000回","10,000,000回","100,000,000回"],"a":3,"e":"100 × 100万 = 1億回 です。"},
        {"q":"2GHzのCPUで、2秒間に処理できる回数はどれか。","c":["10億回","20億回","40億回","80億回"],"a":2,"e":"式：20億 × 2秒 = 40億回 です。"},
        {"q":"「2GHz」と「2000MHz」は、どちらの方が処理が速いか。","c":["2GHzの方が速い","2000MHzの方が速い","どちらも同じ速さ","比較できない"],"a":2,"e":"2GHz = 20億Hz、2000MHz = 20億Hz なので、どちらも同じ速さです。"}

        ],
    "第3回":[
        {"q":"コンピュータを動かすためのプログラムやデータの総称を何というか。","c":["ハードウェア","ソフトウェア","ミドルウェア","マルウェア"],"a":1,"e":"形のある機械が「ハードウェア」、中身のプログラムが「ソフトウェア」です。"},
        {"q":"ソフトウェアは大きく分けて「システムソフトウェア」と何に分類されるか。","c":["ハードウェア","ミドルウェア","アプリケーションソフトウェア","ユーティリティ"],"a":2,"e":"OSなどの土台となる「システム」と、特定の目的（表計算やゲーム等）に使う「アプリ」の2階層が基本です。"},
        {"q":"システムソフトウェアを構成する2つの要素は、「基本ソフトウェア」と何か。","c":["表計算ソフト","ミドルウェア","文書作成ソフト","プレゼンテーションソフト"],"a":1,"e":"OS（基本ソフト）とアプリの中間に位置し、共通機能を提供する「ミドルウェア」で構成されます。"},
        {"q":"「基本ソフトウェア」の別名（略称）はどれか。","c":["CPU","DBMS","OS","SSD"],"a":2,"e":"Operating System（オペレーティングシステム）の略で、WindowsやmacOS、iOSなどが該当します。"},
        {"q":"OSの主な役割として、正しくないものはどれか。","c":["ハードウェアの管理","メモリの割り当て","年賀状の作成","ファイルの管理"],"a":2,"e":"年賀状の作成は「アプリケーションソフトウェア」の役割です。OSはコンピュータを動かすための土台を管理します。"},
        {"q":"基本ソフトとアプリの中間に位置し、データベース管理などの共通機能を提供するソフトを何というか。","c":["ハードウェア","ミドルウェア","ファームウェア","フリーウェア"],"a":1,"e":"複数のアプリで共通して使う機能をまとめることで、開発効率を上げる役割があります。"},
        {"q":"表計算、文書作成、メール、Webブラウザなどのソフトウェアを総称して何というか。","c":["システムソフトウェア","ミドルウェア","アプリケーションソフトウェア","デバイスドライバ"],"a":2,"e":"ユーザーが特定の目的（仕事や遊び）のために利用するソフトウェアのことです。"},
        {"q":"ファイル名の末尾に付く、ファイルの種類を判別するための文字列を何というか。","c":["プレフィックス","インデックス","拡張子","ドメイン"],"a":2,"e":"「.jpg」や「.docx」などの数文字の文字列のことです。"},
        {"q":"静止画ファイルのうち、Webページでよく使われ、256色まで表現可能な形式はどれか。","c":["BMP","JPEG","GIF","PNG"],"a":2,"e":"GIFは256色制限がありますが、アニメーションや透明化が可能です。"},
        {"q":"静止画ファイルのうち、フルカラー（24ビット）表現が可能で、写真などの圧縮に適した形式はどれか。","c":["BMP","JPEG","GIF","TIFF"],"a":1,"e":"JPEGは写真の圧縮に優れていますが、保存を繰り返すと画質が劣化する性質があります。"},
        {"q":"静止画ファイルのうち、画像の劣化がなく、JPEGやGIFの代わりにWebでの利用を目的に開発された形式はどれか。","c":["BMP","MPEG","PNG","PDF"],"a":2,"e":"PNGは透明度の表現が可能で、可逆圧縮（画質が劣化しない）が特徴です。"},
        {"q":"画像を小さな点（画素）の集まりで表し、圧縮を行わないためデータ容量が大きくなる形式はどれか。","c":["PNG","BMP","JPEG","MP3"],"a":1,"e":"BMP（ビットマップ）は、Windows標準の無圧縮画像形式です。"},
        {"q":"動画や音声を圧縮する形式で、DVDやビデオ、携帯端末などで広く使われるのはどれか。","c":["JPEG","BMP","MPEG","GIF"],"a":2,"e":"MPEGは動画データの圧縮規格として最も一般的です。"},
        {"q":"音声ファイルのうち、CD並みの音質を保ちつつ、データ量を約10分の1に圧縮できる形式はどれか。","c":["MP3","MPEG","AVI","WAV"],"a":0,"e":"MP3は音楽配信や携帯音楽プレーヤーで広く普及している音声形式です。"},
        {"q":"「TPモニタ」や「DBMS」は、ソフトウェアの分類上どこに該当するか。","c":["基本ソフトウェア","ミドルウェア","アプリケーションソフトウェア","ハードウェア"],"a":1,"e":"資料にある通り、これらはミドルウェアの代表例です。"},
        {"q":"「DBMS」とは何の略称か。","c":["データ・ベース・マネジメント・システム","データ・バックアップ・メイン・システム","デジタル・ビジネス・メディア・サイト","ディスク・ブート・メモリ・スロット"],"a":0,"e":"データベースを効率よく管理し、データの共用や独立性を保つためのシステムです。"},
        {"q":"「GUI」の説明として適切なものはどれか。","c":["文字だけで操作する画面","アイコンやマウスを使って直感的に操作できる画面","ハードウェアそのもののこと","プログラミング言語の名前"],"a":1,"e":"Graphical User Interfaceの略です。OSが提供する代表的な機能の一つです。"},
        {"q":"ソフトウェア開発の効率を上げるために、ミドルウェアが提供する利点は何か。","c":["パソコンの起動が速くなる","共通機能を開発しなくて済むようになる","インターネットが速くなる","画面が綺麗になる"],"a":1,"e":"アプリ開発者が、一からすべての機能を作らなくて済むようになるため、開発が効率化されます。"},
        {"q":"文書作成ソフトや表計算ソフトを、利用分野による分類で言うと何と呼ぶか。","c":["垂直（バーティカル）アプリ","水平（ホリゾンタル）アプリ","システムアプリ","ミドルアプリ"],"a":1,"e":"業種を問わず、どんな仕事でも共通して使えるため「水平（汎用）」と呼ばれます。"},
        {"q":"OSがアプリケーションに対して提供する、OSの機能を利用するための窓口を何というか。","c":["CPU","USB","API","SSD"],"a":2,"e":"Application Programming Interfaceの略です。これによりアプリは簡単にOSの機能（保存や印刷など）を呼び出せます。"}
        ],
    "第4回":[
        {"q":"マウスを使わず、キーボードからの文字入力だけでコンピュータを操作する画面を何というか。","c":["GUI","CUI","OSI","API"],"a":1,"e":"CUI（Character User Interface）といいます。Windowsの前身であるMS-DOS時代の操作方法です。"},
        {"q":"Windowsなどで、アイコンやマウスを使って直感的に操作できる画面を何というか。","c":["CUI","CUI","GUI","API"],"a":2,"e":"GUI（Graphical User Interface）といいます。現在の主流の操作環境です。"},
        {"q":"DOSプロンプト（コマンドプロンプト）で、現在いる場所にあるファイルの一覧を表示するコマンドはどれか。","c":["cd","dir","type","ren"],"a":1,"e":"「DIRectory」の略である「dir」コマンドを使用します。"},
        {"q":"画面に表示されている文字をすべて消去し、きれいに掃除するコマンドはどれか。","c":["del","cls","exit","md"],"a":1,"e":"「CLear Screen」の略である「cls」コマンドを使用します。"},
        {"q":"ファイルをコピーする際に使用するコマンドはどれか。","c":["copy","ren","move","del"],"a":0,"e":"「copy [元ファイル名] [先ファイル名]」の形で使用します。"},
        {"q":"「type text.txt」というコマンドを入力したときの動作として正しいものはどれか。","c":["ファイルを作成する","ファイル名を変更する","ファイルの内容を表示する","ファイルを削除する"],"a":2,"e":"「type」は指定したテキストファイルの中身を画面に表示させるコマンドです。"},
        {"q":"ディレクトリ（フォルダ）を作成する際に使用するコマンドはどれか。","c":["rd","cd","md","dir"],"a":2,"e":"「Make Directory」の略である「md」または「mkdir」を使用します。"},
        {"q":"DOSプロンプトで、ファイルの作成を終了して保存する際に押すキーの組み合わせはどれか。","c":["Ctrl + C","Ctrl + Z","Ctrl + S","Ctrl + V"],"a":1,"e":"「copy con」でのファイル作成時、「Ctrl + Z」を入力してエンターを押すと保存されます。"},
        {"q":"ネットワーク上のコンピュータ同士が通信する際の共通の約束事を何というか。","c":["プログラミング","プロトコル","アルゴリズム","パスワード"],"a":1,"e":"TCP/IPやHTTPなど、通信を成立させるためのルールです。"},
        {"q":"ドメイン名（https://www.google.com/search?q=google.comなど）を、数字のIPアドレスに変換する仕組みを何というか。","c":["SMTP","POP","DNS","FTP"],"a":2,"e":"DNS（Domain Name System）はインターネット上の「住所録」のような役割をします。"},
        {"q":"メールを「送信」するときに使われるプロトコルはどれか。","c":["POP3","IMAP","SMTP","HTTP"],"a":2,"e":"SMTP（Simple Mail Transfer Protocol）が送信用のプロトコルです。"},
        {"q":"メールを端末に「ダウンロードして閲覧・管理」する受信用プロトコルはどれか。","c":["POP3","IMAP","SMTP","HTTP"],"a":0,"e":"POP3はサーバから自分の端末にメールを取り込む方式です。"},
        {"q":"メールをダウンロードせず、サーバ上で閲覧・管理する受信用プロトコルはどれか。","c":["POP3","IMAP","SMTP","DNS"],"a":1,"e":"IMAPは複数の端末から同じメールを確認するのに適しています。"},
        {"q":"Webブラウザを使わず、専用のソフトも不要でブラウザ上でメールを読み書きするサービスを何というか。","c":["オンラインバンキング","Webメール","SNS","メーリングリスト"],"a":1,"e":"Gmailなどの「Webメール」は、ブラウザさえあればどこでも使えます。"},
        {"q":"「http://www.example.co.jp/」の「jp」が表しているのはどれか。","c":["組織の種類","日本の組織","サーバの種類","ファイルの名前"],"a":1,"e":"「jp」は日本（Japan）に割り当てられた国別ドメインです。"},
        {"q":"DOSプロンプトでファイル名を変更したいときに使うコマンドはどれか。","c":["ren","md","rd","cd"],"a":0,"e":"「REName」の略である「ren」コマンドを使います。"},
        {"q":"ディレクトリ（フォルダ）を移動する際に使うコマンドはどれか。","c":["dir","md","cd","cls"],"a":2,"e":"「Change Directory」の略である「cd」コマンドを使います。"},
        {"q":"インターネットでデータを送る際、情報を小さく分割した単位を何というか。","c":["パケット","ビット","バイト","ブロック"],"a":0,"e":"データを「小包（パケット）」に分けて送ることで、回線を効率よく利用します。"},
        {"q":"通信の信頼性を確保するために、データが届いたか確認を行うプロトコルはどれか。","c":["IP","TCP","HTTP","SMTP"],"a":1,"e":"TCPが通信の「正確さ」を保証し、IPが「住所」を担当します。"},
        {"q":"ブラウザでWebページを閲覧するためのプロトコルはどれか。","c":["FTP","DNS","HTTP","POP3"],"a":2,"e":"HTTP（HyperText Transfer Protocol）を使用してWebサーバと通信します。"}
        ]
    }

};

let gameMode = "normal"; // normal or time
let combo = 0;
let timer = null;
let timeLimit = 10; // 秒
let timeLeft = 0;


// ===== データ取得 =====
function getUsers() {
  const data = localStorage.getItem("users");
  if (!data) return {};
  try {
    return JSON.parse(data);
  } catch (e) {
    return {};
  }
}

function saveUsers(users) {
  localStorage.setItem("users", JSON.stringify(users));
}

// ===== 起動時 =====
window.onload = async () => {
  

  const currentId = localStorage.getItem("currentUser");
  const users = getUsers();

  if (currentId && users[currentId]) {
    showHome(users[currentId]);
  } else {
    showStart();
  }
};

// ===== スタート画面 =====
function showStart() {
  app.innerHTML = `
    <h1>学習ゲーム</h1>
    <button class="main-btn" onclick="showLogin()">ログイン</button>
    <button class="main-btn" onclick="showRegister()">新規登録</button>
    <button class="main-btn" onclick="toggleTheme()">UIカスタム</button>
  `;
}

// ===== 新規登録 =====
function showRegister() {
  app.innerHTML = `
    <h2>新規登録</h2>
    <input id="newName" placeholder="ユーザー名を入力"><br>
    <button class="main-btn" onclick="register()">登録</button>
    <button class="back-btn" onclick="showStart()">戻る</button>
  `;
}


function register() {
  const name = document.getElementById("newName").value.trim();
  if (!name) {
    alert("ユーザー名を入力してください");
    return;
  }

  const id = "ID" + Math.floor(10000 + Math.random() * 90000);
  const users = getUsers();

  users[id] = {
    id: id,
    name: name,
    totalScore: 0,
    scores: {}
  };

  saveUsers(users);
  localStorage.setItem("currentUser", id);
  app.innerHTML = `
    <h2>登録完了！</h2>
    <p>IDを必ずメモしてください</p>
    <h3>${id}</h3>
    
    <button class="main-btn" onclick="showHome(users[id])">ホームへ</button>
  `;
}

// ===== ログイン =====
function showLogin() {
  app.innerHTML = `
    <h2>ログイン</h2>
    <input id="loginId" placeholder="IDを入力"><br>
    <input id="loginName" placeholder="ユーザー名を入力"><br>
    <button class="main-btn" onclick="login()">ログイン</button>
    <button class="back-btn" onclick="showStart()">戻る</button>
  `;
}

function login() {
  let id = document.getElementById("loginId").value.trim().toUpperCase();
  let name = document.getElementById("loginName").value.trim();
  const users = getUsers();

  if (!users[id]) {
    alert("IDが存在しません");
    return;
  }

  if (users[id].name !== name) {
    alert("ユーザー名が違います");
    return;
  }

  localStorage.setItem("currentUser", id);
  showHome(users[id]);
}

// ===== ランク計算 =====
function getRank(score) {
  if (score >= 100) return "S";
  if (score >= 80) return "A";
  if (score >= 60) return "B";
  if (score >= 40) return "C";
  return "D";
}
function getRoundRank(score, totalQuestions) {
  const maxScore = totalQuestions * 10;
  const percent = (score / maxScore) * 100;

  if (percent >= 90) return "S";
  if (percent >= 70) return "A";
  if (percent >= 50) return "B";
  if (percent > 0) return "C";
  return "D";
}

function getStars(score, totalQuestions) {
  const maxScore = totalQuestions * 10;
  const percent = (score / maxScore) * 100;

  if (percent >= 90) return 3;
  if (percent >= 60) return 2;
  if (percent > 0) return 1;
  return 0;
}

function isPerfectClear(subject, user) {
  for (let round of rounds) {
    const key = subject + "_" + round;
    const score = user.scores && user.scores[key] ? user.scores[key] : 0;

    if (score < 60) {
      return false;
    }
  }
  return true;
}

// ===== ホーム画面 =====
function showHome(user) {
  const rank = getRank(user.totalScore);

  app.innerHTML = `
    <h1>ホーム</h1>
    <p>ようこそ ${user.name} さん</p>
    <p>ID: ${user.id}</p>
    <p>合計ベストスコア: ${user.totalScore}</p>
    <p>総合ランク: ${rank}</p>

    <button class="main-btn" onclick="startGame()">問題を解く</button>
    <button class="main-btn" onclick="showRanking()">ランキングを見る</button>
    <button class="main-btn" onclick="toggleTheme()">UIカスタム</button>
    <button class="back-btn" onclick="logout()">ログアウト</button>
  `;
}



// ===== 教科選択画面 =====
function startGame() {
  let html = `
    <h2>教科を選択</h2>
  `;

  subjects.forEach(subject => {
    html += `
      <button class="main-btn subject-btn" onclick="selectSubject('${subject}')">
        ${subject}
      </button><br>
    `;
  });

  html += `
    <button class="back-btn" onclick="goHome()">戻る</button>
  `;

  app.innerHTML = html;
}

// ===== 教科選択処理 =====
function selectSubject(subject) {
  localStorage.setItem("selectedSubject", subject);
  showRoundSelect(subject);
}
function showRoundSelect(subject) {
  const currentId = localStorage.getItem("currentUser");
  const users = getUsers();
  const user = users[currentId];

  let html = `<h2>${subject} - 回を選択</h2>`;

  rounds.forEach(round => {
    const key = subject + "_" + round;
    const score = user.scores && user.scores[key] ? user.scores[key] : 0;
    const totalQuestions =
      quizData[subject] && quizData[subject][round]
        ? quizData[subject][round].length
        : 1;

    const rank = getRoundRank(score, totalQuestions);

    const starCount = getStars(score, totalQuestions);

    // ★ 回ごとに星を作る
    let starsHtml = "";
    for (let i = 0; i < 3; i++) {
      const active = i < starCount ? "star active" : "star";
      starsHtml += `<span class="${active}" style="animation-delay:${i * 0.2}s">★</span>`;
    }

    html += `
      <button class="main-btn" onclick="startRound('${round}')">
        ${round}<br>
        ベスト: ${score} | ランク: ${rank}<br>
        <div class="stars">${starsHtml}</div>
      </button><br>
    `;
  });

  // 完全制覇判定
  if (isPerfectClear(subject, user)) {
    html += `<h3 style="color: gold;">🏆 完全制覇！</h3>`;
  }

  html += `<button class="back-btn" onclick="startGame()">戻る</button>`;

  app.innerHTML = html;
}


let currentQuiz = [];
let currentIndex = 0;
let score = 0;

function startRound(round) {
  const subject = localStorage.getItem("selectedSubject");

  localStorage.setItem("selectedRound", round);

  if (!quizData[subject] || !quizData[subject][round]) {
    alert("この回の問題はまだありません");
    return;
  }

  currentQuiz = quizData[subject][round];
  currentIndex = 0;
  score = 0;

  showModeSelect();
}
function showModeSelect() {
  app.innerHTML = `
    <h2>モード選択</h2>
    <button class="main-btn" onclick="startQuiz('normal')">通常モード</button>
    <button class="main-btn" onclick="startQuiz('time')">時間制限モード</button>
    <button class="back-btn" onclick="startGame()">戻る</button>
  `;
}
function startQuiz(mode) {
  gameMode = mode;
  currentIndex = 0;
  score = 0;
  combo = 0;
  showQuestion();
}
function showQuestion() {
  const question = currentQuiz[currentIndex];

  let timerHtml = "";

  if (gameMode === "time") {
    timeLeft = timeLimit;
    timerHtml = `<h3>残り時間: <span id="timer">${timeLeft}</span> 秒</h3>`;
  }

  let html = `
    <h2>問題 ${currentIndex + 1} / ${currentQuiz.length}</h2>
    ${timerHtml}
    <p>${question.q}</p>
  `;

  question.c.forEach((choice, index) => {
    html += `
      <button class="quiz-btn"
        data-index="${index}"
        onclick="checkAnswer(this, ${index})">
        ${choice}
      </button>
    `;
  });
  html += `<button class="back-btn" onclick="startGame()">中断して戻る</button>`;
  app.innerHTML = html;

  if (gameMode === "time") {
    startTimer();
  }
}
function startTimer() {
  const timerElement = document.getElementById("timer");

  timer = setInterval(() => {
    timeLeft--;
    timerElement.textContent = timeLeft;

    if (timeLeft <= 0) {
      clearInterval(timer);
      combo = 0;
      score -= 5; // タイムオーバー減点
      nextQuestion();
    }
  }, 1000);
}

function checkAnswer(button, selected) {
  const question = currentQuiz[currentIndex];
  if (gameMode === "time") {
    clearInterval(timer);
  }
  const buttons = document.querySelectorAll(".quiz-btn");

  // 全ボタンを無効化
  buttons.forEach(btn => btn.disabled = true);

  if (selected === question.a) {
    if (gameMode === "time") {
      combo++;
      score += 10 + combo; // コンボボーナス
    } else {
      score += 10;
    }
    button.classList.add("correct");
  } else {
    combo = 0;
    button.classList.add("wrong");

    // 正解ボタンも光らせる
    buttons.forEach(btn => {
      if (parseInt(btn.dataset.index) === question.a) {
        btn.classList.add("correct");
      }
    });
  }

  setTimeout(() => {
    showExplanation(question);
  }, 1000);
}
function showExplanation(question) {
  app.innerHTML = `
    <h2>${score} 点</h2>
    <p>解説: ${question.e}</p>
    <button class="main-btn" onclick="nextQuestion()">次へ</button>
  `;
}

function nextQuestion() {
  currentIndex++;

  if (currentIndex < currentQuiz.length) {
    showQuestion();
  } else {
    finishQuiz();
  }
}

function finishQuiz() {
  const subject = localStorage.getItem("selectedSubject");
  const round = localStorage.getItem("selectedRound");
  const key = subject + "_" + round;

  const currentId = localStorage.getItem("currentUser");
  const users = getUsers();
  if (gameMode === "time") {
    const perfectScore = currentQuiz.length * 10;

    if (score >= perfectScore) {
      score += 5; // パーフェクトボーナス
    }
  }
  if (!users[currentId].scores) {
    users[currentId].scores = {};
  }

  const best = users[currentId].scores[key] || 0;

  if (score > best) {
    users[currentId].scores[key] = score;
  }

  // ★ 合計ベスト更新
  let total = 0;
  for (let k in users[currentId].scores) {
    total += users[currentId].scores[k];
  }
  users[currentId].totalScore = total;

  saveUsers(users);

  app.innerHTML = `
    <h2>クイズ終了！</h2>
    <p>スコア: ${score}</p>
    <button class="main-btn" onclick="goHome()">ホームへ</button>
  `;
}


// ===== ホームに戻る =====
function goHome() {
  const currentId = localStorage.getItem("currentUser");
  const users = getUsers();
  showHome(users[currentId]);
}


function showRanking() {
  const users = getUsers();
  const currentId = localStorage.getItem("currentUser");

  // 配列化
  const userArray = Object.values(users);

  // スコアで降順ソート
  userArray.sort((a, b) => b.totalScore - a.totalScore);

  let html = `<h2>🏆 総合ランキング</h2>`;

  userArray.forEach((user, index) => {
    let medal = "";
    if (index === 0) medal = "🥇";
    else if (index === 1) medal = "🥈";
    else if (index === 2) medal = "🥉";

    const isMe = user.id === currentId ? " (あなた)" : "";

    html += `
      <div class="rank-card">
        <h3>${index + 1}位 ${medal}</h3>
        <p>${user.name}${isMe}</p>
        <p>スコア: ${user.totalScore}</p>
      </div>
    `;
  });

  html += `<button class="back-btn" onclick="goHome()">戻る</button>`;

  app.innerHTML = html;
}

function logout() {
  localStorage.removeItem("currentUser");
  showStart();
}

// ===== テーマ切替 =====
function toggleTheme() {
  if (document.body.classList.contains("simple")) {
    document.body.classList.remove("simple");
    document.body.classList.add("game");
  } else {
    document.body.classList.remove("game");
    document.body.classList.add("simple");
  }
}
document.addEventListener("DOMContentLoaded", () => {
  const v = document.getElementById("version");
  if (v) {
    v.innerText = "Version " + APP_VERSION;
  }
});